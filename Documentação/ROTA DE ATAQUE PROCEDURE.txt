ROTEIRO DE ATAQUE TOTAL: A SAGA GAMIR SAÚDEFASE I: FORTIFICAÇÃO E IDENTIDADE (A Base)PassoObjetivo TáticoAção CríticaStatus Atual1. Fundação ArquiteturalImplementar Clean Architecture no Backend e MVVM no Frontend.Program.cs e MauiProgram.cs configurados para DI.CONCLUÍDO2. Cadastro SeguroCriar nova identidade (Cad_UsuarioApp) e proteger senhas.AuthController.cs implementa BCrypt Hashing. RegisterViewModel.cs limpa máscaras.CONCLUÍDO3. Login e EstadoAutenticar o usuário e capturar o estado da conta.AuthController.cs verifica o hash e retorna idPacienteGamir e ContaVerificada. UserDataService.cs armazena o estado.CONCLUÍDO4. Envio de E-mail (Produção)Substituir a simulação de e-mail pelo envio real.EmailService.cs usa SmtpClient e credenciais de appsettings.json para envio real, com template HTML profissional.CONCLUÍDOFASE II: CRIAÇÃO DA PONTE LEGADA (A Chave da Procedure)PassoObjetivo TáticoAção CríticaStatus Atual5. Bloqueio de Acesso (Gatekeeper)Impedir agendamentos de usuários sem idPacienteGamir válido.DashboardViewModel.cs bloqueia os comandos AgendarConsulta e AgendarExame se ContaVerificada = false.CONCLUÍDO6. Verificação de ContaObter o idPaciente legado e criar a ponte para a Procedure.AuthController.cs (VerifyAccount) busca o paciente legado e atribui usuarioApp.idPacienteGamir = pacienteLegado.IdPaciente.CONCLUÍDO7. INSERÇÃO CRÍTICA DO PLANO PADRÃOGarantir o idPacientePlano fixo que a Procedure exige.AuthController.cs (VerifyAccount) insere um registro na Cad_PacientePlano com idPlanoConvenio = 33 (Particular) para o paciente recém-verificado, garantindo que a busca no Passo 9 encontre a chave.CONCLUÍDOFASE III: ATAQUE TOTAL (EXECUÇÃO DA PROCEDURE)Esta fase é o coração da missão, executada por uma Transação ADO.NET atômica no AgendamentoController.cs para chamar a Procedure legada ([CAD_AGENDA_INSERT]).PassoAção Tática na Transação (Backend)Status Atual8. PreparaçãoAbrir conexão SQL e iniciar a transação.CONCLUÍDO9. BUSCA DE CHAVEBuscar o idPacientePlano associado ao Paciente e ao Plano Particular (33), que foi inserido no Passo 7.CONCLUÍDO10. INSERÇÃO TAB_ATENDIMENTOInserir o registro de cabeçalho do atendimento na Tab_Atendimento, preenchendo os campos mínimos e injetando os IDs fixos (Plano 33, Convênio 31, idPacientePlano).CONCLUÍDO11. INSERÇÃO TAB_ATENDIMENTOSERVICOInserir o registro de serviço na Tab_AtendimentoServico, ligando o idAtendimento (do Passo 10) e o IdProcedimento.CONCLUÍDO12. CHAMADA DA PROCEDUREExecutar a Procedure com o comando EXEC [CAD_AGENDA_INSERT] @idAtendimento, usando o idAtendimento obtido no Passo 10.CONCLUÍDO13. FinalizaçãoCommit da transação e fechamento da conexão.CONCLUÍDO