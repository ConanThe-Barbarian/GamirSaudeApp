<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:GamirSaudeApp.ViewModels"
             xmlns:models="clr-namespace:GamirSaudeApp.Models"
             x:Class="GamirSaudeApp.Views.MeusLaudosPage"
             x:DataType="viewmodels:MeusLaudosViewModel"
             Shell.NavBarIsVisible="False"
             NavigationPage.HasNavigationBar="False"
             BackgroundColor="#F5F5F5">

    <Grid RowDefinitions="80, Auto, *, 80" RowSpacing="0">

        <Grid Grid.Row="0" BackgroundColor="#0098DA" Padding="20,10,20,0">
            <Grid ColumnDefinitions="Auto, *">
                <ImageButton Grid.Column="0" 
                             HeightRequest="30" WidthRequest="30" 
                             HorizontalOptions="Start" VerticalOptions="Center" 
                             Command="{Binding VoltarCommand}" 
                             BackgroundColor="Transparent">
                    <ImageButton.Source>
                        <FontImageSource Glyph="&lt;" Color="White" Size="35"/>
                    </ImageButton.Source>
                </ImageButton>

                <Label Grid.Column="1" 
                       Text="Meus Laudos" 
                       TextColor="White" 
                       FontSize="20" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" 
                       VerticalOptions="Center" 
                       Margin="-30,0,0,0"/>
            </Grid>
        </Grid>

        <Border Grid.Row="1" StrokeThickness="0" BackgroundColor="White" Margin="15,15,15,5" Padding="15" StrokeShape="RoundRectangle 10">
            <Border.Shadow>
                <Shadow Brush="Black" Opacity="0.05" Radius="5" Offset="0,2"/>
            </Border.Shadow>
            <VerticalStackLayout Spacing="10">
                <Label Text="Filtrar por perÃ­odo" TextColor="#333333" FontAttributes="Bold" FontSize="14"/>
                <Grid ColumnDefinitions="*,*,Auto" ColumnSpacing="10">
                    <DatePicker Grid.Column="0" Date="{Binding DataInicio}" Format="dd/MM/yyyy" TextColor="#666666" BackgroundColor="#FAFAFA"/>
                    <DatePicker Grid.Column="1" Date="{Binding DataFim}" Format="dd/MM/yyyy" TextColor="#666666" BackgroundColor="#FAFAFA"/>
                    <Button Grid.Column="2" Text="Filtrar" Command="{Binding FiltrarLaudosCommand}" 
                            BackgroundColor="#0098DA" TextColor="White" HeightRequest="40" CornerRadius="8" Padding="15,0"/>
                </Grid>
            </VerticalStackLayout>
        </Border>

        <Grid Grid.Row="2" Padding="15,5">

            <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" 
                               Color="#0098DA" HorizontalOptions="Center" VerticalOptions="Center"/>

            <VerticalStackLayout IsVisible="{Binding IsEmpty}" HorizontalOptions="Center" VerticalOptions="Center" Spacing="10">
                <Label Text="Nenhum laudo encontrado." TextColor="#999999" HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <CollectionView ItemsSource="{Binding LaudosExibidos}" 
                            IsVisible="{Binding IsNotBusy}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:LaudoModel">

                        <Border StrokeShape="RoundRectangle 10" StrokeThickness="0" BackgroundColor="White" Margin="0,0,0,10" Padding="15">

                            <Border.GestureRecognizers>
                                <TapGestureRecognizer 
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MeusLaudosViewModel}}, Path=AbrirLaudoCommand}"
                                    CommandParameter="{Binding .}"/>
                            </Border.GestureRecognizers>

                            <Grid ColumnDefinitions="*, Auto">
                                <VerticalStackLayout Grid.Column="0" Spacing="4">
                                    <Label Text="{Binding NomeExame}" TextColor="#333333" FontAttributes="Bold" FontSize="16" LineBreakMode="TailTruncation"/>
                                    <Label Text="{Binding NomeMedico}" TextColor="#666666" FontSize="12"/>
                                    <Label Text="{Binding DataExame, StringFormat='Realizado em: {0:dd/MM/yyyy}'}" TextColor="#999999" FontSize="11"/>

                                    <Border BackgroundColor="{Binding CorStatus}" StrokeThickness="0" StrokeShape="RoundRectangle 5" 
                                            HorizontalOptions="Start" Padding="8,4" Margin="0,5,0,0">
                                        <Label Text="{Binding Status}" TextColor="White" FontSize="10" FontAttributes="Bold"/>
                                    </Border>
                                </VerticalStackLayout>

                                <ImageButton Grid.Column="1" Source="pdf_icon.png" 
                                             HeightRequest="40" WidthRequest="40" 
                                             VerticalOptions="Center"
                                             BackgroundColor="Transparent"
                                             InputTransparent="True"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>

        <Border Grid.Row="3" Margin="20,10,20,20" StrokeShape="RoundRectangle 20" StrokeThickness="0" BackgroundColor="#0098DA" HeightRequest="60" VerticalOptions="End">
            <Border.Shadow>
                <Shadow Brush="Black" Opacity="0.15" Radius="10" Offset="0,5"/>
            </Border.Shadow>
            <Grid ColumnDefinitions="*,*,*,*">
                <ImageButton Grid.Column="0" Source="home_icon.png" HeightRequest="25" BackgroundColor="Transparent" Command="{Binding HomeCommand}" VerticalOptions="Center"/>
                <ImageButton Grid.Column="1" Source="chat_icon.png" HeightRequest="25" BackgroundColor="Transparent" Command="{Binding ChatCommand}" VerticalOptions="Center"/>
                <ImageButton Grid.Column="2" Source="profile_icon.png" HeightRequest="25" BackgroundColor="Transparent" Command="{Binding ProfileCommand}" VerticalOptions="Center"/>
                <ImageButton Grid.Column="3" Source="calendar_icon.png" HeightRequest="25" BackgroundColor="Transparent" Command="{Binding CalendarCommand}" VerticalOptions="Center"/>
            </Grid>
        </Border>

    </Grid>
</ContentPage>